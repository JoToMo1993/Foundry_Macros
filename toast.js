const ToastsByRace = {
    "Dwarf": [
        "Auf Bergeshöhen und in tiefen Gruben, möge unser Durst nie ruhen!",
        "Ein Zwerg ohne Bier ist wie ein Drache ohne Feuer, voller Zorn und ohne Feuer.",
        "Möge das Bier fließen wie geschmolzenes Gold im Berg, stets reichlich und voller Zwergenwerk.",
        "Auf Klingen, auf Schilde, aufs Bier! Auf dass wir niemals seien nüchtern hier!",
        "Im Bergwerk des Lebens stoßen wir an, auf Freude, auf Glück, auf den Zwergenstamm!",
        "Ein guter Zwerg kennt sein Bier, wie er seinen Hammer schwingt, mit Kraft und ohne Zier.",
        "Möge das Bier so klar sein wie der Sternenhimmel in der Bergnacht, und unsere Kehlen seien stets lachend erwacht.",
        "Auf Brüderschaft, auf Kameradschaft, auf Zwergenheldentat! Das Bier sei süß, der Weg nie zu hart.",
        "Wenn der Durst uns packt, die Kehle so trocken, dann erheben wir das Horn und stoßen an mit frohem Entzücken.",
        "Im Rausch der Zwerge, im Jubel der Halle singen wir Lieder, trinken aufs Wohl der Götter alle.",
        "Auf den Hügeln, in den Höhlen, das Bier sei süß wie Zwergeleben, ohne Qual, ohne Beben.",
        "Mag das Bier fließen wie ein Bergbach klar, und unser Herz schlägt wie der Hammer, Jahr für Jahr.",
        "Auf Bergeskronen und in Bierhallen, möge das Brauwerk niemals fallen.",
        "Auf Zwergenmut, auf Zwergeehre, auf dass unser Bier niemals verkehre.",
        "Im Zwergenlicht, im Zwergenschatten, möge das Bier nie aus uns fliehen, weder heute noch morgen.",
        "Auf die Schätze im Fass, auf das Gold im Glas, möge jeder Schluck ein Zwergenspaß.",
        "Möge der Himmel über uns so fest sein wie der Zwergenschädel, und das Bier so süß wie ein Zwergegedicht.",
        "Auf den Berg, auf die Tiefe, auf dass das Bier nie versiege.",
        "In der Stille der Berge, im Getöse der Taverne, möge das Bier fließen wie die goldene Ader im Erzstern.",
        "Auf Bruderschaft, auf Freude, auf ein Lachen ohne Reue. Das Bier sei süß, die Humpen seien voll, auf Zwergenleben, Prost, zum Wohl!",
        "Auf Felsen fest, auf Biere klar, auf dass kein Zwerg je nüchtern war!",
        "Möge unser Bier sein wie der Bergbach klar, erfrischend und frei von jeglichem Narrenhaar.",
        "Auf Kameradschaft, aufs Bergeschluck, auf dass unser Bier sei stets im Überfluss.",
        "In der Höhle tief, im Humpen hoch, auf das Bier, das fließt im Lebensloch.",
        "Möge unser Durst sein wie der Berg, unermüdlich und voll von Zwergenwerk.",
        "Auf die Hämmer, auf die Biere, auf dass uns keiner das Trinken verliere!",
        "Möge unser Bier fließen wie der Erzstrom tief, stark und niemals langweilig.",
        "Im Zwergenlicht, im Zwergenschatten, möge das Bier nie aus uns fliehen, weder heute noch morgen.",
        "Auf die Zwerge, auf das Bier, auf dass wir niemals werden nüchtern hier!",
        "Möge das Bier sprudeln wie der Zwergenmut, stark und voll von Lebensgut.",
        "Auf Fässer groß, auf Humpen schwer, möge das Bier fließen, immer mehr, immer mehr!",
        "Im Humpen, im Herzen, möge das Bier unsere Dursteskerzen.",
        "Aufs Zwergenleben, aufs Zwergenblut, möge unser Bier fließen wie der Bergesflut.",
        "Möge unser Bier sein wie der Zwergenbart, kräftig, würzig und niemals zu zart.",
        "Auf Bruderschaft, auf Zwergenlachen, möge das Bier in uns erwachen.",
        "Im Bergeskronen und in Bierhallen, möge das Brauwerk niemals fallen.",
        "Auf den Berg, auf die Tiefe, auf dass das Bier nie versiege.",
        "Möge der Himmel über uns so fest sein wie der Zwergenschädel, und das Bier so süß wie ein Zwergegedicht.",
        "Auf Zwergenmut, auf Zwergehuld, auf dass unser Bier sei niemals kalt und immer würzig und voll von Gold.",
        "Möge unser Bier sein wie der Zwergenkern, robust und immer lebendig, niemals fern.",
    ],
    "Dwarf-Dwarfish": [
        "Auf Bergeshöhen und in tiefen Gruben, möge unser Durst nie ruhen!",
        "Ein Zwerg ohne Bier ist wie ein Drache ohne Feuer, voller Zorn und ohne Feuer.",
        "Möge das Bier fließen wie geschmolzenes Gold im Berg, stets reichlich und voller Zwergenwerk.",
        "Auf Klingen, auf Schilde, aufs Bier! Auf dass wir niemals seien nüchtern hier!",
        "Im Bergwerk des Lebens stoßen wir an, auf Freude, auf Glück, auf den Zwergenstamm!",
        "Ein guter Zwerg kennt sein Bier, wie er seinen Hammer schwingt, mit Kraft und ohne Zier.",
        "Möge das Bier so klar sein wie der Sternenhimmel in der Bergnacht, und unsere Kehlen seien stets lachend erwacht.",
        "Auf Brüderschaft, auf Kameradschaft, auf Zwergenheldentat! Das Bier sei süß, der Weg nie zu hart.",
        "Wenn der Durst uns packt, die Kehle so trocken, dann erheben wir das Horn und stoßen an mit frohem Entzücken.",
        "Im Rausch der Zwerge, im Jubel der Halle singen wir Lieder, trinken aufs Wohl der Götter alle.",
        "Auf den Hügeln, in den Höhlen, das Bier sei süß wie Zwergeleben, ohne Qual, ohne Beben.",
        "Mag das Bier fließen wie ein Bergbach klar, und unser Herz schlägt wie der Hammer, Jahr für Jahr.",
        "Auf Bergeskronen und in Bierhallen, möge das Brauwerk niemals fallen.",
        "Auf Zwergenmut, auf Zwergeehre, auf dass unser Bier niemals verkehre.",
        "Im Zwergenlicht, im Zwergenschatten, möge das Bier nie aus uns fliehen, weder heute noch morgen.",
        "Auf die Schätze im Fass, auf das Gold im Glas, möge jeder Schluck ein Zwergenspaß.",
        "Möge der Himmel über uns so fest sein wie der Zwergenschädel, und das Bier so süß wie ein Zwergegedicht.",
        "Auf den Berg, auf die Tiefe, auf dass das Bier nie versiege.",
        "In der Stille der Berge, im Getöse der Taverne, möge das Bier fließen wie die goldene Ader im Erzstern.",
        "Auf Bruderschaft, auf Freude, auf ein Lachen ohne Reue. Das Bier sei süß, die Humpen seien voll, auf Zwergenleben, Prost, zum Wohl!",
        "Auf Felsen fest, auf Biere klar, auf dass kein Zwerg je nüchtern war!",
        "Möge unser Bier sein wie der Bergbach klar, erfrischend und frei von jeglichem Narrenhaar.",
        "Auf Kameradschaft, aufs Bergeschluck, auf dass unser Bier sei stets im Überfluss.",
        "In der Höhle tief, im Humpen hoch, auf das Bier, das fließt im Lebensloch.",
        "Möge unser Durst sein wie der Berg, unermüdlich und voll von Zwergenwerk.",
        "Auf die Hämmer, auf die Biere, auf dass uns keiner das Trinken verliere!",
        "Möge unser Bier fließen wie der Erzstrom tief, stark und niemals langweilig.",
        "Im Zwergenlicht, im Zwergenschatten, möge das Bier nie aus uns fliehen, weder heute noch morgen.",
        "Auf die Zwerge, auf das Bier, auf dass wir niemals werden nüchtern hier!",
        "Möge das Bier sprudeln wie der Zwergenmut, stark und voll von Lebensgut.",
        "Auf Fässer groß, auf Humpen schwer, möge das Bier fließen, immer mehr, immer mehr!",
        "Im Humpen, im Herzen, möge das Bier unsere Dursteskerzen.",
        "Aufs Zwergenleben, aufs Zwergenblut, möge unser Bier fließen wie der Bergesflut.",
        "Möge unser Bier sein wie der Zwergenbart, kräftig, würzig und niemals zu zart.",
        "Auf Bruderschaft, auf Zwergenlachen, möge das Bier in uns erwachen.",
        "Im Bergeskronen und in Bierhallen, möge das Brauwerk niemals fallen.",
        "Auf den Berg, auf die Tiefe, auf dass das Bier nie versiege.",
        "Möge der Himmel über uns so fest sein wie der Zwergenschädel, und das Bier so süß wie ein Zwergegedicht.",
        "Auf Zwergenmut, auf Zwergehuld, auf dass unser Bier sei niemals kalt und immer würzig und voll von Gold.",
        "Möge unser Bier sein wie der Zwergenkern, robust und immer lebendig, niemals fern.",
    ],
    "Halfling": [
        "Auf grünen Hügeln, aufs gute Bier, auf dass das Lachen nie endet, hier, hier!",
        "Im Auenland, im Glückes Winkel, möge das Bier fließen wie der Bach, klar und sprudelnd.",
        "Aufs zweite Frühstück, aufs Abendmahl, auf dass das Bier sei süß wie der Halblingsschal.",
        "Möge unser Bier sein wie der Halblingmut, klein, aber voller Lebensfreud.",
        "Auf Fußhaarlocken, auf Raucherringe, auf das Bier, das unser Herz besinge.",
        "Im Humpen klein, im Herzen groß, möge das Bier fließen, oh du süßer Genuss!",
        "Auf Heiterkeit, aufs Lächeln klar, möge das Bier uns begleiten, immerdar.",
        "Im Auenlandfrieden, im Biergartenlicht, auf dass das Bier sei unser ewiges Gedicht.",
        "Aufs Ringehändchen, aufs Grünebeet, möge das Bier uns beflügeln, süß und prophetisch.",
        "Auf die Fröhlichkeit, auf den Frühlingsschritt, möge das Bier nie verlassen unseren Lippenritt.",
        "Im Halblingfuß, im Herzen leicht, auf dass das Bier unsere Kehlen erreicht.",
        "Aufs Pfeifenrauchen, aufs Auenlandgrün, möge das Bier fließen, wie der Fluss, niemals trüb.",
        "Im Halblinggang, im Zwergenlauf, auf dass das Bier sei süß und niemals schlaff.",
        "Auf die Kürbisfelder, auf die Hopfenranken, möge das Bier uns erfrischen, süß und ohne Gedanken.",
        "Möge das Bier sein wie die Halblingliebe, zart und süß, voller Freude und Triebe.",
        "Aufs Stiefeleck, aufs Gartenheck, möge das Bier fließen, ohne jeden Dreck.",
        "Aufs Lachhügelland, auf die Halblingfreud, möge das Bier uns beglücken, immerzu heut.",
        "Im Auenländerwein, im Halblingstrunk, möge das Bier uns umhüllen, süß und ohne Schluck.",
        "Aufs Gasthauslicht, aufs Abendrot, möge das Bier fließen, immerfort.",
        "Auf die Halblingfüße, auf die Halblingseele, möge das Bier uns erfreuen, immer und in Fülle.",
    ],
    "Elf": [
        "Unter den Sternen, im Elfenlicht, möge das Ambrosia fließen, süß und leicht.",
        "Auf die Blätter, auf die Zweige, möge das Nektarwasser fließen, im Elfenreiche.",
        "Möge der Wein sein wie das Elfenspiel, voller Anmut, ohne jedes Kühle.",
        "Im Erynnóre-Mond, im Weinbergszauber, möge der Wein fließen, als Elfentrunk.",
        "Auf die Eleganz, auf die Elfenweisen, möge der Wein uns die Freude preisen.",
        "In den Elfenhainen, im Zauberglanz, auf dass der Wein uns fülle, im Elfentanz.",
        "Möge der Nektar süß sein wie Elfenlied, sanft und harmonisch, voller elfischer Fried.",
        "Auf die Sternenpfade, auf das Elfenauge, möge das Ambrosia fließen, eine himmlische Saat.",
        "Im Morgenlicht, im Dämmerzauber, auf dass der Wein sei unser edler Rausch.",
        "Auf die Elfenkunst, auf das Elfengold, möge der Wein uns berauschen, voll und hold.",
        "Möge der Nektar fließen wie der Elfensang, melodisch und süß, den ganzen Tag lang.",
        "In den Erynnóre-Wellen, im Weinbergsrausch, auf dass der Wein sei unsere süße Lausch.",
        "Auf die Elfenschöpfung, auf das Blütenschiff, möge das Ambrosia fließen, unser Elfenhof.",
        "Im Mondlichtglanz, im Weinbergsraum, auf dass der Wein uns erhebe, im Elfenbaum.",
        "Möge der Nektar sein wie Elfentraum, leicht und flüchtig, wie im Abendhauch.",
        "Auf die Elfenzeit, auf den Sternenschein, möge der Wein uns berauschen, so süß und fein.",
        "Im Elfenwald, im Weinbergsgrün, möge der Wein uns beglücken, im Mondenschein.",
        "Möge der Nektar sein wie Elfentat, zart und stark, wie der Morgentau.",
        "Auf die Elfenflügel, auf das Elfenspiel, möge das Ambrosia fließen, sanft und viel.",
        "Im Elfennest, im Weinbergsrausch, auf dass der Wein uns erhebe, im Sternenhaus.",
    ]
};

const DiceTypes = [
    {"name": "d100", "factor": 100},
    {"name": "d20", "factor": 20},
    {"name": "d12", "factor": 12},
    {"name": "d10", "factor": 10},
    {"name": "d8", "factor": 8},
    {"name": "d6", "factor": 6},
    {"name": "d5", "factor": 5},
    {"name": "d4", "factor": 4},
    {"name": "d3", "factor": 3},
    {"name": "d2", "factor": 2},
];

function getDiceFor(len) {
    let dice = "";

    DiceTypes.forEach(diceType => {
        while (len % diceType.factor === 0) {
            dice += diceType.name + "*";
            len /= diceType.factor;
        }
    });

    if (len > 1) {
        dice += "d" + len
    } else if (dice.length > 0) {
        dice = dice.substring(0, dice.length - 1);
    }

    return dice;
}

function optionOf(race) {
    return `<option value='${race}'>${race}</option>`;
}

const popupTemplate = `
<table>
  <tr>
    <td><label for='race'>Race</label></td>
    <td>
      <select name='race' id='race'>
        ${Object.keys(ToastsByRace).map(race => optionOf(race)).join()}
      </select>
    </td>
  </tr>
</table>
`;

function dialogSubmit() {
    let race = document.getElementById("race").value;
    let toasts = ToastsByRace[race];
    let diceDef = getDiceFor(toasts.length) + "-1";

    console.log(diceDef);

    let roll = new Roll(diceDef).roll()

    roll.then(result => {
        game.dice3d?.showForRoll(result);
        let chatData = {
            user: game.user.id,
            content: `<div class=\"convenient-effects-chat-header\"><p>${toasts[result.total]}</p></div>`,
            blind: false
        };

        ChatMessage.create(chatData, {});
    })
}

let d = new Dialog({
    title: 'Toast',
    content: popupTemplate,
    buttons: {
        ok: {
            icon: '<i class="fas fa-check"></i>',
            label: "Do it!",
            callback: dialogSubmit
        },
        cancel: {
            icon: '<i class="fas fa-times"></i>',
            label: "Never mind",
            callback: () => {
            }
        }
    }
});
d.render(true);